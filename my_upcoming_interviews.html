<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Upcoming Interviews â€” IST</title>
<style>
  body{font-family:Segoe UI, sans-serif; margin:0; padding:20px; background:#f8faff; color:#142028;}
  h1{color:#3b82f6; text-align:center;}
  ul{list-style:none; padding:0; margin:0; max-width:800px; margin:auto;}
  li{background:#fff; margin:6px 0; padding:12px; border-radius:8px; display:flex; gap:12px; font-weight:600;}
  .debug{font-family:monospace; white-space:pre-wrap; background:#fff; padding:12px; border-radius:8px; margin-top:20px;}
</style>
</head>
<body>
<h1>ðŸ“Œ Upcoming Interviews (IST)</h1>
<ul id="slots-list"><li>Loading...</li></ul>
<div class="debug" id="debug"></div>

<script>
(async function(){
  const debugEl = document.getElementById('debug');
  const listEl = document.getElementById('slots-list');

  const log = msg => { 
    debugEl.textContent += msg + "\n"; 
    console.log(msg);
  };

  const formatIST = dtStr => {
    const d = new Date(dtStr);
    if(isNaN(d)) return dtStr;
    const utc = d.getTime() + d.getTimezoneOffset()*60000;
    const ist = new Date(utc + 5.5*60*60*1000);
    const days=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    let h=ist.getHours(), m=ist.getMinutes().toString().padStart(2,'0'), am=h>=12?'PM':'AM';
    h=h%12||12;
    return `${days[ist.getDay()]}, ${months[ist.getMonth()]} ${ist.getDate()}, ${ist.getFullYear()}, ${h}:${m} ${amp} IST`;
  };

  const urls = [
    './slots.json',
    '/slots.json',
    'https://raw.githubusercontent.com/naveenkumaritaimlds/naveenkumaritaimlds.github.io/main/slots.json'
  ];

  let data = null;
  for(const url of urls){
    try{
      log(`Trying: ${url}`);
      const resp = await fetch(url, {cache:'no-store'});
      if(!resp.ok) throw new Error(resp.status+' '+resp.statusText);
      const json = await resp.json();
      if(Array.isArray(json)) { data=json; log(`Loaded ${json.length} slots.`); break; }
      log('Not an array.');
    }catch(e){ log('Error: '+e.message); }
  }

  listEl.innerHTML = '';
  if(!data || !data.length){
    listEl.innerHTML = '<li>No interviews scheduled.</li>';
    return;
  }

  // Sort by datetime
  data.sort((a,b)=> new Date(a.datetime) - new Date(b.datetime));

  // Efficiently append all items
  const frag = document.createDocumentFragment();
  data.forEach(s=>{
    const li = document.createElement('li');
    li.textContent = `ðŸ“… ${formatIST(s.datetime)}`;
    frag.appendChild(li);
  });
  listEl.appendChild(frag);
})();
</script>
</body>
</html>
