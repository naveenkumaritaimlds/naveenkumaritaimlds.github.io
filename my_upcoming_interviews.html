<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>My Upcoming Interviews</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
body {
  font-family: Inter, system-ui, sans-serif;
  background: #f6f8fb;
  color: #1f2d3d;
  margin: 0;
  padding: 20px;
}
h1 { text-align: center; font-size: 22px; margin-bottom: 16px; }
ul#slotsList { list-style: none; padding: 0; max-width: 600px; margin: 0 auto; }
ul#slotsList li {
  background: #fff;
  margin: 10px 0;
  padding: 14px 18px;
  border-radius: 10px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.05);
  font-size: 15px;
}
#diagnostics {
  margin-top: 30px;
  font-size: 13px;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
  background: #fff8e1;
  border: 1px solid #ffecb3;
  padding: 12px;
  border-radius: 8px;
}
#editor { display:none; max-width:700px; margin:20px auto; }
#fallbackJson { width:100%; height:180px; font-family:monospace; font-size:13px; }
button {
  margin-top: 8px;
  background: #4a90e2;
  color: #fff;
  border: 0;
  padding: 8px 14px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
}
</style>
</head>
<body>
<h1>📅 My Upcoming Interviews</h1>

<ul id="slotsList"></ul>

<div id="diagnostics"></div>

<div id="editor">
  <h2 style="font-size:16px;">Inline JSON fallback / editor</h2>
  <textarea id="fallbackJson"></textarea><br>
  <button id="reloadBtn">Reload from Editor</button>
</div>

<script>
const SLOTS_URL = "https://naveenkumaritaimlds.github.io/slots.json";
const slotsList = document.getElementById("slotsList");
const diagnostics = document.getElementById("diagnostics");
const editor = document.getElementById("editor");
const fallbackJson = document.getElementById("fallbackJson");

function log(msg) { diagnostics.innerHTML += msg + "<br>"; }

function formatIST(isoString) {
  const d = new Date(isoString);
  if (isNaN(d)) return isoString;
  const opts = { timeZone: "Asia/Kolkata", weekday:"short", year:"numeric", month:"short", day:"numeric", hour:"numeric", minute:"2-digit", hour12:true };
  return d.toLocaleString("en-US", opts) + " IST";
}

function render(list) {
  slotsList.innerHTML = "";
  if (!list.length) {
    slotsList.innerHTML = "<li>No upcoming interviews.</li>";
    return;
  }
  list.forEach(e => {
    const li = document.createElement("li");
    li.textContent = formatIST(e.datetime);
    slotsList.appendChild(li);
  });
}

async function load() {
  diagnostics.innerHTML = "";
  try {
    const res = await fetch(SLOTS_URL, {cache:"no-store"});
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    log("Fetched raw entries: " + data.length);
    const valid = data.filter(e => e.datetime);
    log("Parsed valid entries: " + valid.length);
    valid.sort((a,b)=> new Date(a.datetime)-new Date(b.datetime));
    log("Displayed (after filter): " + valid.length);
    if (valid[0]) log("Sample earliest valid: " + valid[0].datetime);
    render(valid);
    log("Fetch OK");
  } catch (err) {
    log("❌ Fetch failed: " + err.message);
    editor.style.display = "block";
  }
}

document.getElementById("reloadBtn").onclick = () => {
  try {
    const json = JSON.parse(fallbackJson.value);
    render(json);
    log("Loaded from inline editor: " + json.length + " entries");
  } catch(e) { alert("Invalid JSON: " + e.message); }
};

load();
</script>
</body>
</html>
